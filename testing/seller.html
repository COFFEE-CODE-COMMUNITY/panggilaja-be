<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Seller Chat</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 700px;
        margin: 20px auto;
        background: #fef3c7;
      }
      h1 {
        font-size: 22px;
      }
      input,
      button,
      textarea {
        padding: 8px;
        margin: 4px 0;
        border-radius: 6px;
        border: 1px solid #ddd;
      }
      button {
        cursor: pointer;
        background: #d97706;
        color: white;
        border: none;
      }
      #messages {
        height: 300px;
        overflow-y: auto;
        background: white;
        border-radius: 8px;
        padding: 10px;
        margin-top: 10px;
      }
      .msg {
        margin-bottom: 8px;
        padding: 6px;
        border-radius: 6px;
      }
      .me {
        background: #fde68a;
        text-align: right;
      }
      .other {
        background: #f3f4f6;
      }
    </style>
  </head>
  <body>
    <h1>üè™ Seller Chat</h1>
    <p>Server: <input id="server" value="http://localhost:5000" size="30" /></p>
    <p>
      Buyer ID: <input id="buyerId" value="buyer123" /> Seller ID:
      <input id="sellerId" value="seller123" />
    </p>
    <button id="connectBtn">Connect</button>
    <button id="joinBtn" disabled>Join Room</button>

    <div id="messages"></div>

    <div style="margin-top: 10px">
      <textarea
        id="messageInput"
        rows="2"
        placeholder="Type message..."
      ></textarea
      ><br />
      <button id="sendBtn" disabled>Send Message</button>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      let socket;
      const connectBtn = document.getElementById("connectBtn");
      const joinBtn = document.getElementById("joinBtn");
      const sendBtn = document.getElementById("sendBtn");
      const messages = document.getElementById("messages");
      const messageInput = document.getElementById("messageInput");

      function addMsg(msg, fromMe = false) {
        const div = document.createElement("div");
        div.className = "msg " + (fromMe ? "me" : "other");
        div.textContent = msg;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      connectBtn.onclick = () => {
        const url = document.getElementById("server").value;
        socket = io(url, { transports: ["websocket"] });
        socket.on("connect", () => {
          console.log("Connected:", socket.id);
          addMsg("‚úÖ Connected to server", false);
          joinBtn.disabled = false;
        });
        socket.on("receive_message", (msg) => {
          addMsg(`üí¨ Buyer: ${msg.text}`);
        });
      };

      joinBtn.onclick = () => {
        const buyerId = document.getElementById("buyerId").value;
        const sellerId = document.getElementById("sellerId").value;
        socket.emit("join_room", { buyerId, sellerId });
        addMsg(`üè† Joined room ${buyerId}_${sellerId}`, false);
        sendBtn.disabled = false;
      };

      sendBtn.onclick = () => {
        const buyerId = document.getElementById("buyerId").value;
        const sellerId = document.getElementById("sellerId").value;
        const text = messageInput.value;
        socket.emit("send_message", {
          id_buyer: buyerId,
          id_seller: sellerId,
          text,
        });
        addMsg(`You: ${text}`, true);
        messageInput.value = "";
      };
    </script>
  </body>
</html>
